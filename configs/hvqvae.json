{
  "model": {
    "type": "HVQVAE",
    "format": "model+dict",
    "model+dict": {
      "content_encoder": "content_encoder",
      "reference_encoder": "reference_encoder",
      "decoder": "decoder"
    }
  },
  "trainer": {
    "type": "HVQVAERunner",
    "restore_scale": true
  },
  "optimizers": {
    "model_optimizer": {
      "type": "AdamW",
      "groups": [
        {
          "params": "model",
          "lr": 1e-3,
          "weight_decay": 1e-4
        }
      ]
    }
  },
  "metric_callbacks": [
    {
      "type": "MSECallback",
      "input_key": "outputs_255",
      "target_key": "targets_255",
      "metric_key": "MSE_255",
      "eval_only": true
    },
    {
      "type": "PSNRCallback",
      "input_key": "outputs_255",
      "target_key": "targets_255",
      "metric_key": "PSNR_255",
      "max_pixel_value": 255,
      "eval_only": true
    },
    {
      "type": "FNMSECallback",
      "input_key": "outputs",
      "target_key": "targets_and_masks",
      "metric_key": "FN-MSE",
      "min_area": 100.0,
      "eval_only": true
    },
    {
      "type": "fMSECallback",
      "input_key": "outputs_255",
      "target_key": "targets_and_masks_255",
      "metric_key": "fMSE_255",
      "eval_only": true
    },
    {
      "type": "MSECallback",
      "input_key": "reconstruct_content_alpha",
      "target_key": "content_alpha",
      "metric_key": "reconstruction_loss",
      "train_only": true
    },
    {
      "type": "MSECallback",
      "input_key": "harmonize_content_alpha",
      "target_key": "content_beta",
      "metric_key": "harmonization_loss",
      "train_only": true
    },
    {
      "type": "MSECallback",
      "input_key": "content_feat_alpha",
      "target_key": "content_feat_beta",
      "metric_key": "content_consistency_loss",
      "train_only": true
    },
    {
      "type": "MSECallback",
      "input_key": "reference_feat_alpha",
      "target_key": "content_appearance_feat_alpha",
      "metric_key": "reference_consistency_loss",
      "train_only": true
    },
    {
      "type": "MetricAggregationCallback",
      "metric_key": "disentanglement_loss",
      "metrics": {
        "content_consistency_loss": 1,
        "reference_consistency_loss": 1
      },
      "mode": "weighted_sum",
      "train_only": true
    },
    {
      "type": "IdentityCallback",
      "input_key": "latent_loss_content",
      "target_key": "latent_loss_content",
      "metric_key": "latent_loss_content",
      "train_only": true
    },
    {
      "type": "IdentityCallback",
      "input_key": "latent_loss_reference",
      "target_key": "latent_loss_reference",
      "metric_key": "latent_loss_reference",
      "train_only": true
    },
    {
      "type": "IdentityCallback",
      "input_key": "latent_loss",
      "target_key": "latent_loss",
      "metric_key": "latent_loss",
      "eval_only": true
    },
    {
      "type": "MetricAggregationCallback",
      "metric_key": "latent_loss",
      "metrics": {
        "latent_loss_content": 1,
        "latent_loss_reference": 1
      },
      "mode": "weighted_sum",
      "train_only": true
    },
    {
      "type": "MetricAggregationCallback",
      "metric_key": "loss",
      "metrics": {
        "latent_loss": 1,
        "reconstruction_loss": 0.4,
        "harmonization_loss": 1,
        "disentanglement_loss": 0.05
      },
      "mode": "weighted_sum",
      "train_only": true
    }
  ],
  "optimizers_callbacks": [
    {
      "metric_key": "loss",
      "model_key": "model",
      "optimizer_key": "model_optimizer"
    }
  ],
  "checkpoints_callbacks": [
    {
      "use": false,
      "loader_key": "valid",
      "metric_key": "PSNR_255",
      "minimize": false,
      "save_n_best": 1,
      "logdir": "somewhere"
    }
  ],
  "schedulers": {
    "model_optimizer": {
      "type": "MultiStepLR",
      "milestones": [160, 175],
      "gamma": 0.1,
      "mode": "epoch"
    }
  },
  "data": {
    "dataset_paths": {
      "HCOCO": "../data/HCOCO",
      "HAdobe5k": "../data/HAdobe5k_resized1024",
      "HFlickr": "../data/HFlickr",
      "Hday2night": "../data/Hday2night",
      "RealHM": "../data/RealHM_resized1024",
      "MSCOCO": "../data/MSCOCO/train/data"
    },
    "train": {
      "datasets": ["MSCOCO"],
      "type": "SSHTrainDataset",
      "augmentations": {
        "HorizontalFlip": {}
      },
      "crop": {
        "type": "RandomResizedCrop",
        "height": 256,
        "width": 256,
        "scale": [0.3, 0.55]
      },
      "additional_targets": {
        "content_beta": "image",
        "reference_beta": "image",
        "reference_alpha": "image"
      }
    },
    "test": {
      "datasets": ["RealHM"],
      "type": "SSHTestDataset",
      "augmentations": {
        "Resize": {
          "height": 256,
          "width": 256
        }
      },
      "additional_targets": {
        "target": "image",
        "reference_image": "image"
      }
    },
    "batch_size": 16,
    "num_workers": 12
  },
  "gpus": "",
  "num_epochs": 180,
  "project_name": "gml_harm_testing",
  "experiments_folder": "../diplom_exps"
}